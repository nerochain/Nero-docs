# アーキテクチャ

<div style={{ height: '2rem' }} />
<div style={{ textAlign: 'center' }}>
  <img src="/assets/aaPlatform/figure1.png" alt="Figure 1" />
  <p style={{ fontStyle: 'italic' }}>Figure 1: Architecture</p>
</div>

## 主要コンポーネントの仕様

### Entrypoint

* 汎用的なアカウントアブストラクション（AA）インフラストラクチャとして機能するスマートコントラクトであり、グローバルに一意である必要があります。
* UserOperationの処理を担当します。

### Bundler

* UserOperationを収集し、保留中のUserOperationを管理するためのMemPoolを提供します。
* DoS攻撃を防ぐためにUserOperationの有効性を検証します。
* UserOperationをまとめ、トランザクション手数料を支払い、従来のトランザクションに組み立てた後、Entrypointに送信します。
* EntrypointがUserOperationを実行した後、Bundlerが指定した受益者アドレスにUserOperationの手数料を払い戻します。
* ユーザー向けに必要なJson-rpc APIを提供します。

### AAプラットフォーム

* 開発者向けに提供されるPaymaster管理プラットフォームです。
* AAウォレットアプリケーションやDAPP開発者向けに、ガス補助やトークン支払い機能をエンドユーザーに提供するためのPaymasterインフラを提供します。
* 開発者がカスタム支払い戦略を定義できる機能を備えています。
* アカウント残高の管理を行います。
* Webhooksメカニズムを提供し、特定のUserOperationがPaymasterの署名前後でスポンサーシップ戦略に適合しているかを開発者が検証できる仕組みを提供します。

### Paymaster API

* 開発者がPaymasterを利用するためのAPIを提供します。

### 開発者向けSDK

* 開発者がUserOperationを構築するためのSDKを提供します。
* Nero Paymaster APIにアクセスするためのSDKを提供します。
* 現在、JSバージョンのSDKのみが対象とされています。

### Paymaster & Paymasterテンプレート

* 公式のPaymasterコントラクトを提供します。
* 開発者が支払い戦略をカスタマイズできるようにするPaymasterテンプレートを実装します（具体的な機能は未定です）。

### プライスサービス

* トークンPaymaster用に、トークンと$NEROの為替レートを提供し、特定のUserOperationに必要なトークン量を計算するサービスが必要です。
* この価格サービスは主に通貨価格の情報元に関わるため、jpチームによって提供される必要があります。

### ユーザ向けアプリケーション

Includes all applications for end-users, such as AA Wallet and DAPPs. The AA Wallet can be built by Nero or in collaboration with third-party AA wallet service providers, allowing third-party wallets to support the Nero chain and integrate Nero’s Bundler and paymaster services.

### AAウォレットの基本機能

* 複数のログイン/権限制御方法をサポート。他のサービス（例：Particle）の事例を参考にすることができます。
* Dappの利用シーンやニーズに応じたスマートコントラクトウォレットを提供します.
* 従来のウォレット機能：トークンの受け取り/送信、トークンの追加などを提供します。
* ソーシャルリカバリー機能を提供します。
* 必要に応じて、ガス代の補助やトークンベースの支払い機能を提供します。
* Dappがウォレットと接続し、やり取りを行うためのSDKを提供します。
* DappがUserOperation（Paymasterデータを含む）を構築できるようにし、カスタマイズされたガス補助や支払い方法を実現します。